# TODO: better roles in ansible
#
# ANSIBLE_HOSTS=core flock play @@core warewulf --extra-vars='master=core'
#
---
# PTP
- include: roles/warewulf/ptpd.yml
# install warewulf toolkit
# TODO: make upstream packages
- include: roles/warewulf/warewulf.yml

- include: roles/warewulf/tools.yml

# ansible for the clones
- include: roles/warewulf/ansible.yml

# slurm stuff
- include: roles/warewulf/slurm.yml

# nfs server for homes
# TODO: lustre ceph and FhGfs
# - include: roles/warewulf/nfsserver.yml

# basic node helth check
# TODO
# - include: roles/warewulf/healthcheck.yml

# ganglia procstat
- include: roles/warewulf/procstat.yml

- hosts: all
  tasks:
    - name: Warewulf state done
      lineinfile: dest=/etc/ANSIBLE_STATE
                  regexp="^warewulf"
                  line=warewulf
                  state=present
                  create=yes
      tags:
        - state
